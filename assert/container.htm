
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>干部学习新干线--播放课程</title>
<style type="text/css">
* { margin:0; padding:0; border:0;}
html,body, #studyBoxId{ height:100%; margin:0; overflow:hidden}

。submit_btn { border:1px solid #ccc; margin-top:5px; padding:4px; cursor: pointer;}
.notice_intro { color:#ff0000; text-align: center; height: 100px; margin-top: 20px; font-size: 14px; line-height: 20px;}
</style>
<script language="javascript" src="/js/jquery-1.7.js"></script>
<script src="/html/default/js/clw_min.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/study/showDialog.js"></script>
<script type="text/javascript" src="/js/study/playcourse.js?v=20170208"></script>

</head>
<body scroll=no style="overflow:hidden;">
<div id="studyBoxId"></div>
<script language="javascript">
/*获取URL参数*/
function getParameter(name)
{
	var h=location.href;
	if(h.indexOf('?')==-1)return "";
	var x=h.substring(h.indexOf('?')+1).split("&");
	for(var i=0;i<x.length;i++)
	{
		if(x[i].indexOf(name+"=")==0)
		{
			return x[i].replace(name+"=","");
		}
	}
	return "";
}

/*通过参数获取课程ID*/
var courseid=getParameter("courseid");//课程ID
var courseTitle=getParameter("coursetitle");//课程名称
var delay=getParameter("delay");
var logId = 0;

if(!courseid){
	alert('参数错误');
	window.close();
}
//盗链检查
if(!window.opener){ //判断使用window.open打开的窗口
	alert("请确认您是否进行盗链操作！");
	window.close();
}
//打开新窗口时，更新课程id到session
$.ajax({
		type: "post",
		url: "/study/ajax.php",
		data: {act:'set_course_session',courseId:courseid,delay:delay},
		async: false,
		cache: false,
		success:function(data, textStatus){
				if(data.err != 0){
					alert(data.msg);
					if(data.err==2){
						window.location.href='/study/login.php'
					}
					window.close();	
					return false;
				}
			},
		error:function(data){
				alert(data.msg);
				window.close();	
				return false;
			},
		dataType:'json'
	});


//获取课程播放地址并开始播放
$.ajax({
		type: "post",
		url: "/study/ajax.php",
		data: {act:'getCourseURL',courseId:courseid},
		async: false,
		cache: false,
		success:function(data, textStatus){
				if(data.err != 0){
					alert(data.msg);
					if(data.err==2){
						window.location.href='/study/login.php'
					}
					window.close();	
					return false;
				}
				if(data.url == '' || data.url == undefined){//检查课程信息
					alert("没有该课件！");
					window.close();	
					return false;
					
				}
				/*再次检查盗链*/
				if(!window.opener){ //判断使用window.open打开的窗口
					alert("请确认您是否进行盗链操作！");
					window.close();
					return false;
				}
				
				/*开始播放*/
				//插入播放日志
				createlogid();
				//打开播放窗口
				var iframeObj = document.createElement("IFRAME"); //IFRAM (内容)
				iframeObj.src = data.url;
				iframeObj.width = '100%';
				iframeObj.height = '100%';
				iframeObj.zIndex=0;
				document.getElementById('studyBoxId').appendChild(iframeObj);
				
				//document.write("<head><title>"+courseTitle+"</title></head><frameset><frame src='"+data.url+"'></frameset>");
				//document.write("<head><title>"+courseTitle+"</title></head><frameset><frame src='"+data.url+"'></frameset>");
				startPlayCourse();//开始播放计时
				window.onbeforeunload = unloadCourseFrame;
				window.onunload = unloadCourseFrame;


					
			},
		error:function(data){
				alert("没有该课件！");
				window.close();	
				return false;
			},
		dataType:'json'
	});
</script>
</body>
</html>
